var _=new WeakMap,z;function $(e,c){return z=z||new ResizeObserver(f=>{for(let n of f){let u=_.get(n.target);u&&u(n)}}),_.set(e,c),z.observe(e),{destroy(){z.unobserve(e),_.delete(e)}}}const q=(e,c)=>Math.hypot(e.x-c.x,e.y-c.y),H=(e,c)=>({x:(e.x+c.x)/2,y:(e.y+c.y)/2}),K=(e,c)=>({x:e.x-c.x,y:e.y-c.y}),S=.02,tt=120;function et(e,c){const f=window.devicePixelRatio,n=e.getContext("2d"),u=requestAnimationFrame;let x,g,w,C,v,P,T,E=e.width=e.clientWidth*f,I=e.height=e.clientHeight*f,a,m=0,r={vx:0,vy:0,ts:0};const h=new Map,p=[];function F(t){({width:g,height:w,render:C,padding:v,maxZoom:P,friction:T}={padding:0,maxZoom:16,friction:.97,...t}),x=Math.min(e.width/(g+v*f),e.height/(w+v*f)),n.resetTransform(),n.translate(e.width/2,e.height/2),n.scale(x,x),n.translate(-g/2,-w/2),D(),a=l({x:e.width/2,y:e.height/2}),b()}F(c);const U=$(e,t=>{const o=t.contentRect,i=l({x:E/2,y:I/2}),s=n.getTransform();E=o.width*f,I=o.height*f,e.width=E,e.height=I,x=Math.min(e.width/(c.width+v*f),e.height/(c.height+v*f)),n.setTransform(s),a=l({x:E/2,y:I/2}),n.translate(a.x-i.x,a.y-i.y),m||A(performance.now())});function O(t){for(;p.length&&t-p[0].t>tt;)p.shift()}function V(t){const o=performance.now();O(o),p.push({point:t,t:o})}function D(){m&&(cancelAnimationFrame(m),m=0),r.vx=0,r.vy=0,p.length=0}function X(){const t=l({x:0,y:0}),o=l({x:e.width,y:e.height});t.x>g&&(n.translate(t.x-g,0),r.vx=-r.vx),t.y>w&&(n.translate(0,t.y-w),r.vy=-r.vy),o.x<0&&(n.translate(o.x,0),r.vx=-r.vx),o.y<0&&(n.translate(0,o.y),r.vy=-r.vy)}function Y(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);const o=R(t);h.set(t.pointerId,o),D()}function L(t){if(t.stopPropagation(),e.releasePointerCapture(t.pointerId),h.delete(t.pointerId),h.size===0&&(O(performance.now()),p.length>1)){const o=p[0],i=p[p.length-1],s=i.point.x-o.point.x,d=i.point.y-o.point.y,y=i.t-o.t;r={vx:s/y,vy:d/y,ts:performance.now()},b()}}function Z(t){if(t.stopPropagation(),!h.has(t.pointerId))return;const o=R(t);switch(h.size){case 1:{const i=l(o);V(i);const s=h.get(t.pointerId),d=K(i,l(s));a=i,k(d),b(),h.set(t.pointerId,o);break}case 2:{let i=[...h.values()],s=l(i[0]),d=l(i[1]);const y=H(s,d),j=q(s,d);h.set(t.pointerId,o),i=[...h.values()],s=l(i[0]),d=l(i[1]);const W=H(s,d),G=q(s,d),J=K(W,y);k(J);const Q=G/j;N(W,Q);break}}}function B(t){t.preventDefault(),t.stopPropagation();const o=R(t),i=Math.exp(-t.deltaY/512);N(l(o),i)}function k(t){n.translate(t.x,t.y),X()}function N(t,o){function i(d){n.translate(t.x,t.y),n.scale(d,d),n.translate(-t.x,-t.y)}i(o);const s=n.getTransform();s.a<x&&i(x/s.a),s.a>P&&i(P/s.a),a=t,b()}function R(t){return{x:t.offsetX*f,y:t.offsetY*f}}function l(t){return n.getTransform().inverse().transformPoint(t)}function b(){m||(m=u(A))}function A(t){n.save(),n.resetTransform(),n.clearRect(0,0,e.width,e.height),n.restore();const o=C(n,t,a),i=Math.abs(r.vx)>S||Math.abs(r.vy)>S;if(i){const s=t-r.ts,d=r.vx*s,y=r.vy*s;k({x:d,y}),r.vx*=T,r.vy*=T,r.ts=t}i||o?m=u(A):m=0}const M={passive:!0};return e.addEventListener("pointerdown",Y,M),e.addEventListener("pointerup",L,M),e.addEventListener("pointercancel",L,M),e.addEventListener("pointermove",Z,M),e.addEventListener("wheel",B),{update(t){F(t)},destroy(){U.destroy(),e.removeEventListener("pointerdown",Y),e.removeEventListener("pointerup",L),e.removeEventListener("pointercancel",L),e.removeEventListener("pointermove",Z),e.removeEventListener("wheel",B)}}}export{et as p};
