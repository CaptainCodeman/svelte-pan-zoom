var A=new WeakMap,L;function Q(e,c){return L=L||new ResizeObserver(l=>{for(let o of l){let y=A.get(o.target);y&&y(o)}}),A.set(e,c),L.observe(e),{destroy(){L.unobserve(e),A.delete(e)}}}const W=(e,c)=>Math.hypot(e.x-c.x,e.y-c.y),q=(e,c)=>({x:(e.x+c.x)/2,y:(e.y+c.y)/2}),H=(e,c)=>({x:e.x-c.x,y:e.y-c.y}),K=.02,$=120;function tt(e,c){const l=window.devicePixelRatio,o=e.getContext("2d"),y=requestAnimationFrame;let a,u,g,_,w,b,M,z=e.width=e.clientWidth*l,P=e.height=e.clientHeight*l,m=0,r={vx:0,vy:0,ts:0};const h=new Map,p=[];function C(t){({width:u,height:g,render:_,padding:w,maxZoom:b,friction:M}={padding:0,maxZoom:16,friction:.97,...t}),a=Math.min(e.width/(u+w*l),e.height/(g+w*l)),o.resetTransform(),o.translate(e.width/2,e.height/2),o.scale(a,a),o.translate(-u/2,-g/2),O(),E()}C(c);const S=Q(e,t=>{const n=t.contentRect,i=f({x:z/2,y:P/2}),s=o.getTransform();z=n.width*l,P=n.height*l,e.width=z,e.height=P,a=Math.min(e.width/(c.width+w*l),e.height/(c.height+w*l)),o.setTransform(s);const d=f({x:e.width/2,y:e.height/2});o.translate(d.x-i.x,d.y-i.y),m||R(performance.now())});function F(t){for(;p.length&&t-p[0].t>$;)p.shift()}function U(t){const n=performance.now();F(n),p.push({point:t,t:n})}function O(){m&&(cancelAnimationFrame(m),m=0),r.vx=0,r.vy=0,p.length=0}function V(){const t=f({x:0,y:0}),n=f({x:e.width,y:e.height});t.x>u&&(o.translate(t.x-u,0),r.vx=-r.vx),t.y>g&&(o.translate(0,t.y-g),r.vy=-r.vy),n.x<0&&(o.translate(n.x,0),r.vx=-r.vx),n.y<0&&(o.translate(0,n.y),r.vy=-r.vy)}function D(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);const n=k(t);h.set(t.pointerId,n),O()}function v(t){if(t.stopPropagation(),e.releasePointerCapture(t.pointerId),h.delete(t.pointerId),h.size===0&&(F(performance.now()),p.length>1)){const n=p[0],i=p[p.length-1],s=i.point.x-n.point.x,d=i.point.y-n.point.y,x=i.t-n.t;r={vx:s/x,vy:d/x,ts:performance.now()},E()}}function Y(t){if(t.stopPropagation(),!h.has(t.pointerId))return;const n=k(t);switch(h.size){case 1:{U(f(n));const i=h.get(t.pointerId),s=H(f(n),f(i));T(s),E(),h.set(t.pointerId,n);break}case 2:{let i=[...h.values()],s=f(i[0]),d=f(i[1]);const x=q(s,d),X=W(s,d);h.set(t.pointerId,n),i=[...h.values()],s=f(i[0]),d=f(i[1]);const N=q(s,d),j=W(s,d),G=H(N,x);T(G);const J=j/X;B(N,J);break}}}function Z(t){t.preventDefault(),t.stopPropagation();const n=k(t),i=Math.exp(-t.deltaY/512);B(f(n),i)}function T(t){o.translate(t.x,t.y),V()}function B(t,n){function i(d){o.translate(t.x,t.y),o.scale(d,d),o.translate(-t.x,-t.y)}i(n);const s=o.getTransform();s.a<a&&i(a/s.a),s.a>b&&i(b/s.a),E()}function k(t){return{x:t.offsetX*l,y:t.offsetY*l}}function f(t){return o.getTransform().inverse().transformPoint(t)}function E(){m||(m=y(R))}function R(t){o.save(),o.resetTransform(),o.clearRect(0,0,e.width,e.height),o.restore();const n=_(o,t),i=Math.abs(r.vx)>K||Math.abs(r.vy)>K;if(i){const s=t-r.ts,d=r.vx*s,x=r.vy*s;T({x:d,y:x}),r.vx*=M,r.vy*=M,r.ts=t}i||n?m=y(R):m=0}const I={passive:!0};return e.addEventListener("pointerdown",D,I),e.addEventListener("pointerup",v,I),e.addEventListener("pointercancel",v,I),e.addEventListener("pointermove",Y,I),e.addEventListener("wheel",Z),{update(t){C(t)},destroy(){S.destroy(),e.removeEventListener("pointerdown",D),e.removeEventListener("pointerup",v),e.removeEventListener("pointercancel",v),e.removeEventListener("pointermove",Y),e.removeEventListener("wheel",Z)}}}export{tt as p};
