var _=new WeakMap,P;function Q(e,c){return P=P||new ResizeObserver(d=>{for(let o of d){let l=_.get(o.target);l&&l(o)}}),_.set(e,c),P.observe(e),{destroy(){P.unobserve(e),_.delete(e)}}}const q=(e,c)=>Math.hypot(e.x-c.x,e.y-c.y),H=(e,c)=>({x:(e.x+c.x)/2,y:(e.y+c.y)/2}),K=(e,c)=>({x:e.x-c.x,y:e.y-c.y}),S=.02,tt=120;function et(e,c){const d=window.devicePixelRatio,o=e.getContext("2d"),l=requestAnimationFrame;let y,g,w,C,v,z,T,E=e.width=e.clientWidth*d,L=e.height=e.clientHeight*d,u,m=0,i={vx:0,vy:0,ts:0};const p=new Map,a=[];function F(t){({width:g,height:w,render:C,padding:v,maxZoom:z,friction:T}={padding:0,maxZoom:16,friction:.97,...t}),y=Math.min(e.width/(g+v*d),e.height/(w+v*d)),o.resetTransform(),o.translate(e.width/2,e.height/2),o.scale(y,y),o.translate(-g/2,-w/2),O(),u=h({x:e.width/2,y:e.height/2}),b()}F(c);const U=Q(e,t=>{const n=t.contentRect,r=h({x:E/2,y:L/2}),s=o.getTransform();E=n.width*d,L=n.height*d,e.width=E,e.height=L,y=Math.min(e.width/(c.width+v*d),e.height/(c.height+v*d)),o.setTransform(s),u=h({x:E/2,y:L/2}),o.translate(u.x-r.x,u.y-r.y),m||A(performance.now())});function D(t){for(;a.length&&t-a[0].t>tt;)a.shift()}function V(t){const n=performance.now();D(n),a.push({point:t,t:n})}function O(){m&&(cancelAnimationFrame(m),m=0),i.vx=0,i.vy=0,a.length=0}function X(){const t=h({x:0,y:0}),n=h({x:e.width,y:e.height});t.x>g&&(o.translate(t.x-g,0),i.vx=-i.vx),t.y>w&&(o.translate(0,t.y-w),i.vy=-i.vy),n.x<0&&(o.translate(n.x,0),i.vx=-i.vx),n.y<0&&(o.translate(0,n.y),i.vy=-i.vy)}function Y(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);const n=R(t);p.set(t.pointerId,n),O()}function I(t){if(t.stopPropagation(),e.releasePointerCapture(t.pointerId),p.delete(t.pointerId),p.size===0&&(D(performance.now()),a.length>1)){const n=a[0],r=a[a.length-1],s=r.point.x-n.point.x,f=r.point.y-n.point.y,x=r.t-n.t;i={vx:s/x,vy:f/x,ts:performance.now()},b()}}function Z(t){if(t.stopPropagation(),!p.has(t.pointerId))return;const n=R(t);switch(p.size){case 1:{const r=h(n);V(r);const s=p.get(t.pointerId),f=K(r,h(s));u=r,k(f),b(),p.set(t.pointerId,n);break}case 2:{let r=[...p.values()],s=h(r[0]),f=h(r[1]);const x=H(s,f),$=q(s,f);p.set(t.pointerId,n),r=[...p.values()],s=h(r[0]),f=h(r[1]);const W=H(s,f),j=q(s,f),G=K(W,x);k(G);const J=j/$;N(W,J);break}}}function B(t){t.preventDefault(),t.stopPropagation();const n=R(t),r=Math.exp(-t.deltaY/512);N(h(n),r)}function k(t){o.translate(t.x,t.y),X()}function N(t,n){function r(f){o.translate(t.x,t.y),o.scale(f,f),o.translate(-t.x,-t.y)}r(n);const s=o.getTransform();s.a<y&&r(y/s.a),s.a>z&&r(z/s.a),u=t,b()}function R(t){return{x:t.offsetX*d,y:t.offsetY*d}}function h(t){return o.getTransform().inverse().transformPoint(t)}function b(){m||(m=l(A))}function A(t){o.save(),o.resetTransform(),o.clearRect(0,0,e.width,e.height),o.restore();const n=C(o,t,u),r=Math.abs(i.vx)>S||Math.abs(i.vy)>S;if(r){const s=t-i.ts,f=i.vx*s,x=i.vy*s;k({x:f,y:x}),i.vx*=T,i.vy*=T,i.ts=t}r||n?m=l(A):m=0}const M={passive:!0};return e.addEventListener("pointerdown",Y,M),e.addEventListener("pointerup",I,M),e.addEventListener("pointercancel",I,M),e.addEventListener("pointermove",Z,M),e.addEventListener("wheel",B),{update(t){F(t)},destroy(){U.destroy(),e.removeEventListener("pointerdown",Y),e.removeEventListener("pointerup",I),e.removeEventListener("pointercancel",I),e.removeEventListener("pointermove",Z),e.removeEventListener("wheel",B)}}}function ot(e){let c=["click","touchstart","mousedown","mousemove"],d={capture:!0};function o(l){l.preventDefault(),l.stopPropagation()}return c.forEach(l=>e.addEventListener(l,o,d)),{destroy(){c.forEach(l=>e.removeEventListener(l,o,d))}}}export{et as p,ot as s};
