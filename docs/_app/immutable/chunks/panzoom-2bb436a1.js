var I=new WeakMap,g;function H(t,i){return g=g||new ResizeObserver(d=>{for(let o of d){let h=I.get(o.target);h&&h(o)}}),I.set(t,i),g.observe(t),{destroy(){g.unobserve(t),I.delete(t)}}}const C=(t,i)=>Math.hypot(t.x-i.x,t.y-i.y),Z=(t,i)=>({x:(t.x+i.x)/2,y:(t.y+i.y)/2}),O=(t,i)=>({x:t.x-i.x,y:t.y-i.y});function S(t,i){const d=window.devicePixelRatio,o=t.getContext("2d");let h,w,a,z,m,x,y=t.width=t.clientWidth*d,E=t.height=t.clientHeight*d;function P(e){({width:w,height:a,render:z,padding:m,maxZoom:x}={padding:0,maxZoom:16,...e}),h=Math.min(t.width/(w+m*d),t.height/(a+m*d)),o.resetTransform(),o.translate(t.width/2,t.height/2),o.scale(h,h),o.translate(-w/2,-a/2),u()}P(i);const W=H(t,e=>{const s=e.contentRect,r=f({x:y/2,y:E/2}),n=o.getTransform();y=s.width*d,E=s.height*d,t.width=y,t.height=E,h=Math.min(t.width/(i.width+m*d),t.height/(i.height+m*d)),o.setTransform(n);const p=f({x:t.width/2,y:t.height/2});o.translate(p.x-r.x,p.y-r.y),u()}),l=new Map;function b(e){e.stopPropagation(),t.setPointerCapture(e.pointerId);const s=L(e);l.set(e.pointerId,s)}function c(e){e.stopPropagation(),t.releasePointerCapture(e.pointerId),l.delete(e.pointerId)}function M(e){if(e.stopPropagation(),!l.has(e.pointerId))return;const s=L(e);switch(l.size){case 1:{const r=l.get(e.pointerId),n=O(f(s),f(r));R(n),u(),l.set(e.pointerId,s);break}case 2:{let r=[...l.values()],n=f(r[0]),p=f(r[1]);const Y=Z(n,p),A=C(n,p);l.set(e.pointerId,s),r=[...l.values()],n=f(r[0]),p=f(r[1]);const k=Z(n,p),B=C(n,p),D=O(k,Y);R(D);const F=B/A;_(k,F);break}}}function T(e){e.preventDefault(),e.stopPropagation();const s=L(e),r=Math.exp(-e.deltaY/512);_(f(s),r)}function R(e){o.translate(e.x,e.y)}function _(e,s){function r(p){o.translate(e.x,e.y),o.scale(p,p),o.translate(-e.x,-e.y)}r(s);const n=o.getTransform();n.a<h&&r(h/n.a),n.a>x&&r(x/n.a),u()}function L(e){return{x:e.offsetX*d,y:e.offsetY*d}}function f(e){return o.getTransform().inverse().transformPoint(e)}function u(){o.save(),o.resetTransform(),o.clearRect(0,0,t.width,t.height),o.restore(),z(o)}return t.addEventListener("pointerdown",b,{passive:!0}),t.addEventListener("pointerup",c,{passive:!0}),t.addEventListener("pointercancel",c,{passive:!0}),t.addEventListener("pointermove",M,{passive:!0}),t.addEventListener("wheel",T),{update(e){P(e)},destroy(){W.destroy(),t.removeEventListener("pointerdown",b),t.removeEventListener("pointerup",c),t.removeEventListener("pointercancel",c),t.removeEventListener("pointermove",M),t.removeEventListener("wheel",T)}}}export{S as p};
