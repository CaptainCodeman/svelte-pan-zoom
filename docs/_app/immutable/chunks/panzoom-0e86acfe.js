const _=(e,s)=>Math.hypot(e.x-s.x,e.y-s.y),O=(e,s)=>({x:(e.x+s.x)/2,y:(e.y+s.y)/2}),Z=(e,s)=>({x:e.x-s.x,y:e.y-s.y});let g;const b=new WeakMap;function H(e,s){g=g||new ResizeObserver(t=>{for(const i of t){const o=b.get(i.target);o&&o(i)}});const p=window.devicePixelRatio,r=e.getContext("2d");let f,w,x,z,m,a,y=e.width=e.clientWidth*p,E=e.height=e.clientHeight*p;function I(t){({width:w,height:x,render:z,padding:m,maxZoom:a}={padding:0,maxZoom:16,...t}),f=Math.min(e.width/(w+m*p),e.height/(x+m*p)),r.resetTransform(),r.translate(e.width/2,e.height/2),r.scale(f,f),r.translate(-w/2,-x/2),u()}I(s),b.set(e,t=>{const i=t.contentRect,o=l({x:y/2,y:E/2}),n=r.getTransform();y=i.width*p,E=i.height*p,e.width=y,e.height=E,f=Math.min(e.width/(s.width+m*p),e.height/(s.height+m*p)),r.setTransform(n);const d=l({x:e.width/2,y:e.height/2});r.translate(d.x-o.x,d.y-o.y),u()}),g.observe(e);const h=new Map;function P(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);const i=L(t);h.set(t.pointerId,i)}function c(t){t.stopPropagation(),e.releasePointerCapture(t.pointerId),h.delete(t.pointerId)}function M(t){if(t.stopPropagation(),!h.has(t.pointerId))return;const i=L(t);switch(h.size){case 1:{const o=h.get(t.pointerId),n=Z(l(i),l(o));k(n),u(),h.set(t.pointerId,i);break}case 2:{let o=[...h.values()],n=l(o[0]),d=l(o[1]);const W=O(n,d),Y=_(n,d);h.set(t.pointerId,i),o=[...h.values()],n=l(o[0]),d=l(o[1]);const R=O(n,d),B=_(n,d),D=Z(R,W);k(D);const F=B/Y;C(R,F);break}}}function T(t){t.preventDefault(),t.stopPropagation();const i=L(t),o=Math.exp(-t.deltaY/512);C(l(i),o)}function k(t){r.translate(t.x,t.y)}function C(t,i){function o(d){r.translate(t.x,t.y),r.scale(d,d),r.translate(-t.x,-t.y)}o(i);const n=r.getTransform();n.a<f&&o(f/n.a),n.a>a&&o(a/n.a),u()}function L(t){return{x:t.offsetX*p,y:t.offsetY*p}}function l(t){return r.getTransform().inverse().transformPoint(t)}function u(){r.save(),r.resetTransform(),r.clearRect(0,0,e.width,e.height),r.restore(),z(r)}return e.addEventListener("pointerdown",P,{passive:!0}),e.addEventListener("pointerup",c,{passive:!0}),e.addEventListener("pointercancel",c,{passive:!0}),e.addEventListener("pointermove",M,{passive:!0}),e.addEventListener("wheel",T),{update(t){I(t)},destroy(){g.unobserve(e),b.delete(e),e.removeEventListener("pointerdown",P),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),e.removeEventListener("pointermove",M),e.removeEventListener("wheel",T)}}}export{H as p};
